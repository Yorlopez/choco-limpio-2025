{% extends 'base.html' %} <!-- Le digo a esta plantilla que use 'base.html' como su esqueleto principal. -->

{% block title %}Mi Perfil | Chocó Limpio{% endblock %} <!-- Relleno el bloque 'title' de la plantilla base con el título específico de esta página. -->

{% block styles %} <!-- Abro un bloque para poner los estilos CSS que solo se usarán en esta página. -->
    <link rel="stylesheet" href="/static/css/perfil.css"> <!-- Cargo la hoja de estilos específica para la página de perfil. -->
{% endblock %} <!-- Cierro el bloque de los estilos. -->

{% block content %} <!-- Abro el bloque principal donde va a ir todo el contenido de esta página. -->
        <div class="row justify-content-center"> <!-- Creo una fila y centro su contenido horizontalmente. -->
            <div class="col-lg-8"> <!-- Creo una columna que en pantallas grandes ocupará 8 de 12 espacios. -->
                <div class="profile-card"> <!-- La tarjeta principal que contiene toda la información del perfil. -->
                    <div class="text-center mb-4 position-relative"> <!-- Un contenedor centrado para la foto y los datos principales. -->
                        <img src="{{ user.avatar_url or url_for('static', filename='assets/default-avatar.png') }}" alt="Foto de perfil" class="avatar" id="avatarImage"> <!-- Muestro la foto de perfil del usuario. Si no tiene, muestro una por defecto. -->
                        <label for="avatarUpload" class="edit-avatar-btn"> <!-- Este es el botón para editar la foto. Es una etiqueta que al hacer clic, activa el campo de abajo. -->
                            <i class="bi bi-pencil-fill"></i> <!-- Pongo un icono de un lápiz dentro del botón. -->
                        </label> <!-- Cierro la etiqueta del botón. -->
                        <input type="file" id="avatarUpload" style="display: none;" accept="image/*"> <!-- Este es el campo real para subir archivos, pero está oculto. Solo acepta imágenes. -->

                        <h2 class="mb-1">{{ user.nombre }}</h2> <!-- Muestro el nombre completo del usuario. -->
                        <p class="text-white-50">@{{ user.telefono }}</p> <!-- Muestro el teléfono del usuario como si fuera un nombre de usuario. -->
                        <p><i class="bi bi-geo-alt-fill"></i> {{ user.barrio }}</p> <!-- Muestro el barrio del usuario con un icono de ubicación. -->
                    </div> <!-- Cierro el contenedor de la foto. -->

                    <form id="editForm" method="POST" action="/perfil"> <!-- El formulario para editar los datos, que enviará la información a la ruta '/perfil'. -->
                        <div class="row g-3"> <!-- Una fila para organizar los campos del formulario en columnas. -->
                            <div class="col-md-6"> <!-- La primera columna, para el nombre. -->
                                <label class="form-label">Nombre</label> <!-- La etiqueta del campo. -->
                                <input type="text" class="form-control" name="nombre" value="{{ user.nombre }}" required> <!-- El campo para editar el nombre, con el valor actual ya puesto. -->
                            </div> <!-- Cierro la columna. -->
                            <div class="col-md-6"> <!-- La segunda columna, para el teléfono. -->
                                <label class="form-label">Teléfono</label> <!-- La etiqueta. -->
                                <input type="text" class="form-control" value="{{ user.telefono }}" disabled> <!-- Muestro el teléfono, pero deshabilitado para que no se pueda cambiar. -->
                            </div> <!-- Cierro la columna. -->
                            <div class="col-md-6"> <!-- Otra columna, para el barrio. -->
                                <label class="form-label">Barrio</label> <!-- La etiqueta. -->
                                <input type="text" class="form-control" name="barrio" value="{{ user.barrio }}" required> <!-- El campo para editar el barrio. -->
                            </div> <!-- Cierro la columna. -->
                            <div class="col-md-6"> <!-- Otra columna, para el email. -->
                                <label class="form-label">Email</label> <!-- La etiqueta. -->
                                <input type="email" class="form-control" name="email" value="{{ user.email or '' }}"> <!-- El campo para editar el email. Si no tiene, lo dejo vacío. -->
                            </div> <!-- Cierro la columna. -->
                            <div class="col-12"> <!-- Una columna que ocupa todo el ancho, para la fecha de nacimiento. -->
                                <label class="form-label">Fecha de Nacimiento</label> <!-- La etiqueta. -->
                                <input type="date" class="form-control" name="fecha_nac" value="{{ (user.fecha_nac | string)[:10] }}" max="{{ now().strftime('%Y-%m-%d') }}"> <!-- El campo de fecha, mostrando la fecha actual y con la fecha de hoy como máximo. -->
                            </div> <!-- Cierro la columna. -->
                        </div> <!-- Cierro la fila de campos. -->
                        <div class="mt-4 text-center"> <!-- Un contenedor centrado para los botones de acción. -->
                            <button type="submit" class="btn btn-edit px-5">Guardar Cambios</button> <!-- El botón para guardar los cambios del formulario. -->
                            
                            {% if user.rol == 'admin' %} <!-- Reviso si el rol del usuario es 'admin'. -->
                                <a href="/admin/solicitudes" class="btn btn-outline-light px-5 ms-2">Cancelar</a> <!-- Si es admin, el botón de cancelar lo lleva al panel de solicitudes. -->
                            {% elif user.rol == 'lanchero' %} <!-- Si no, reviso si es 'lanchero'. -->
                                <a href="/lanchero" class="btn btn-outline-light px-5 ms-2">Cancelar</a> <!-- Si es lanchero, lo lleva a su panel. -->
                            {% else %} <!-- Si no es ninguno de los anteriores (es un usuario normal)... -->
                                <a href="/dashboard" class="btn btn-outline-light px-5 ms-2">Cancelar</a> <!-- ...el botón de cancelar lo lleva a su dashboard. -->
                            {% endif %} <!-- Termino la serie de condiciones. -->
                        </div> <!-- Cierro el contenedor de los botones. -->
                    </form> <!-- Cierro el formulario de edición. -->
                    <div class="text-center mt-4 pt-3 border-top border-secondary"> <!-- Una sección para eliminar la cuenta, separada por una línea. -->
                        <p class="text-white-50">¿Deseas eliminar tu cuenta permanentemente?</p> <!-- Un texto de advertencia. -->
                        <button id="deleteAccountBtn" class="btn btn-danger">Eliminar Cuenta</button> <!-- El botón rojo que activa la función de eliminar en JavaScript. -->
                    </div> <!-- Cierro la sección de eliminar cuenta. -->
                    <div id="successMsg" class="alert alert-success mt-3" style="display:none;">Perfil actualizado</div> <!-- Un mensaje de éxito que está oculto y que mi JavaScript mostrará cuando sea necesario. -->
                </div> <!-- Cierro la tarjeta principal del perfil. -->
            </div> <!-- Cierro la columna. -->
        </div> <!-- Cierro la fila. -->
{% endblock %} <!-- Cierro el bloque de contenido principal. -->

{% block scripts %} <!-- Abro un bloque para los scripts de JavaScript de esta página. -->
    <script src="/static/js/perfil.js"></script> <!-- Cargo el script que maneja la lógica de esta página (editar perfil, subir foto, eliminar cuenta). -->
{% endblock %} <!-- Cierro el bloque de scripts. -->